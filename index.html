<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#667eea">
    <title>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã‚¢ãƒ—ãƒª</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* ç”»é¢å…¨ä½“ã‚’ãƒ‡ãƒã‚¤ã‚¹ã«ãƒ•ã‚£ãƒƒãƒˆã•ã›ã‚‹è¨­å®š */
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px; /* ã‚¹ãƒãƒ›ã§è¦‹ã‚„ã™ã„ä½™ç™½ */
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1000px; /* PCã§ã‚‚åºƒãŒã‚Šã™ããªã„ã‚ˆã†ã«åˆ¶é™ */
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            flex-grow: 1;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šç”»é¢ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: clamp(20px, 5vw, 40px);
            text-align: center;
        }

        .content { padding: clamp(15px, 4vw, 30px); }

        /* ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒƒã‚­ï¼šãƒ‡ãƒã‚¤ã‚¹å¹…ã«åˆã‚ã›ã¦æ¨ªä¸¦ã³ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ */
        .deck-item {
            background: #f8f9ff;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 12px;
            display: flex;
            flex-wrap: wrap; /* è¦ç´ ãŒå…¥ã‚Šåˆ‡ã‚‰ãªã„å ´åˆã¯æŠ˜ã‚Šè¿”ã™ */
            justify-content: space-between;
            align-items: center;
            border: 2px solid #e5e7eb;
            gap: 15px;
        }

        .deck-info { flex: 1; min-width: 200px; }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼šç”»é¢å¹…ã«åˆã‚ã›ã¦ä¼¸ç¸® */
        .progress-bar-container {
            background: #e5e7eb;
            border-radius: 10px;
            height: 8px;
            width: 100%;
            max-width: 300px;
            margin-top: 8px;
            overflow: hidden;
        }

        /* å­¦ç¿’ç”»é¢ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰ï¼šå…¨ç”»é¢ã«åºƒãŒã‚‹ã‚ˆã†ã«ä¿®æ­£ */
        .flashcard-modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .flashcard-container {
            background: white;
            width: 95%; /* ãƒ¢ãƒã‚¤ãƒ«ã§å·¦å³ã«å°‘ã—éš™é–“ã‚’ä½œã‚‹ */
            max-width: 600px; /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆä»¥ä¸Šã§å¤§ãããªã‚Šã™ããªã„ */
            border-radius: 20px;
            padding: clamp(15px, 5vw, 30px);
            max-height: 95vh;
            overflow-y: auto;
        }

        /* ã‚«ãƒ¼ãƒ‰ã®ã‚µã‚¤ã‚ºã‚’ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã§ç¶­æŒ */
        .flashcard {
            perspective: 1000px;
            aspect-ratio: 4 / 3; /* é»„é‡‘æ¯”ã«è¿‘ã„ã‚µã‚¤ã‚º */
            width: 100%;
            max-height: 350px;
            margin: 15px 0;
        }

        .flashcard-face {
            font-size: clamp(1.2rem, 5vw, 2rem); /* æ–‡å­—ã‚µã‚¤ã‚ºã‚’å¯å¤‰ã« */
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
        }

        /* ãƒœã‚¿ãƒ³é¡ã®ã‚µã‚¤ã‚ºã‚’èª¿æ•´ */
        .btn {
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 0.95rem;
            cursor: pointer;
            border: none;
            font-weight: bold;
            transition: 0.2s;
        }

        .flashcard-controls {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2åˆ—ã«ä¸¦ã¹ã‚‹ */
            gap: 8px;
            margin-top: 15px;
        }

        /* ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ãƒƒã‚¿ãƒ¼ */
        .version-footer {
            text-align: right;
            padding: 10px;
            color: rgba(255,255,255,0.7);
            font-size: 10px;
        }

        /* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
        #toast {
            visibility: hidden; min-width: 200px; background-color: #333; color: #fff;
            text-align: center; border-radius: 50px; padding: 12px; position: fixed;
            z-index: 2000; left: 50%; bottom: 40px; transform: translateX(-50%);
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2s; }

        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 40px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 40px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸƒ ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</h1>
            <p>ãƒ‡ãƒã‚¤ã‚¹æœ€é©åŒ–ç‰ˆ</p>
        </div>
        <div class="content">
            <div class="upload-section" style="border: 2px dashed #667eea; border-radius:15px; padding:30px; text-align:center; margin-bottom:20px; background:#f8f9ff;">
                <input type="file" id="fileInput" accept=".xlsx,.xls">
                <button class="btn" style="background:#667eea; color:white; width:100%; max-width:300px;" onclick="document.getElementById('fileInput').click()">Excelã‚’èª­ã¿è¾¼ã‚€</button>
            </div>
            <div id="deckItems"></div>
        </div>
    </div>
    
    <div id="toast"></div>
    <div class="version-footer" id="versionTag"></div>

    <div class="flashcard-modal" id="flashcardModal">
        <div class="flashcard-container">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span id="flashcardProgress" style="font-weight:bold; color:#667eea; font-size:0.9rem;"></span>
                <button class="btn" style="background:#ef4444; color:white; padding:5px 15px;" onclick="closeFlashcards()">âœ•</button>
            </div>
            <div class="flashcard">
                <div class="flashcard-inner" id="flashcardInner" onclick="flipCard()" style="position:relative; width:100%; height:100%; transition: transform 0.6s; transform-style: preserve-3d;">
                    <div class="flashcard-face flashcard-front" id="flashcardFront" style="position:absolute; width:100%; height:100%; backface-visibility:hidden; background:#f0f4ff; color:#333; border:2px solid #667eea; display:flex; align-items:center; justify-content:center;"></div>
                    <div class="flashcard-face flashcard-back" id="flashcardBack" style="position:absolute; width:100%; height:100%; backface-visibility:hidden; background:#10b981; color:white; transform: rotateY(180deg); display:flex; align-items:center; justify-content:center;"></div>
                </div>
            </div>
            <div style="text-align:center; margin-bottom:10px;">
                <button id="masteredBtn" class="btn" style="width:100%; border:2px solid #667eea; background:white; color:#667eea;" onclick="toggleMastered()">âœ… è¦šãˆãŸï¼</button>
            </div>
            <div class="flashcard-controls">
                <button class="btn" style="background:#667eea; color:white;" onclick="prevCard()">â† å‰ã¸</button>
                <button class="btn" style="background:#667eea; color:white;" onclick="nextCard()">æ¬¡ã¸ â†’</button>
                <button id="shuffleBtn" class="btn" style="background:#e5e7eb; color:#333;" onclick="toggleShuffle()">ğŸ”€ ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
                <button class="btn" style="background:#10b981; color:white;" onclick="flipCard()">ğŸ”„ è£è¿”ã™</button>
            </div>
            <div style="background:#f8f9ff; padding:15px; border-radius:10px; margin-top:15px;">
                <p style="font-size:0.8rem; font-weight:bold; margin-bottom:5px;">â• ã‚«ãƒ¼ãƒ‰è¿½åŠ </p>
                <div style="display:flex; flex-direction:column; gap:8px;">
                    <input type="text" id="newQ" placeholder="å•é¡Œ" style="padding:10px; border:1px solid #ccc; border-radius:5px;">
                    <input type="text" id="newA" placeholder="å›ç­”" style="padding:10px; border:1px solid #ccc; border-radius:5px;">
                    <button class="btn" style="background:#10b981; color:white;" onclick="addCard()">è¿½åŠ ã™ã‚‹</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const VERSION = "26.01.21.2330"; 
        let decks = {};
        let currentDeckId = null;
        let currentCardIndex = 0;
        let displayOrder = [];
        let isShuffleOn = false;

        window.addEventListener('load', () => {
            document.getElementById('versionTag').textContent = `Ver: ${VERSION}`;
            loadDecks();
            renderDecks();
        });

        function showToast(msg) {
            const t = document.getElementById("toast");
            t.textContent = msg;
            t.className = "show";
            setTimeout(() => { t.className = ""; }, 2500);
        }

        function saveDecks() { localStorage.setItem('flashcard_decks', JSON.stringify(decks)); }
        function loadDecks() {
            const saved = localStorage.getItem('flashcard_decks');
            if (saved) decks = JSON.parse(saved);
        }

        function renderDecks() {
            const container = document.getElementById('deckItems');
            container.innerHTML = '';
            Object.keys(decks).forEach(id => {
                const deck = decks[id];
                const masteredCount = deck.cards.filter(c => c.mastered).length;
                const percent = Math.round((masteredCount / deck.cards.length) * 100) || 0;
                const item = document.createElement('div');
                item.className = 'deck-item';
                item.innerHTML = `
                    <div class="deck-info">
                        <div style="font-weight:bold; color:#667eea;">${deck.name}</div>
                        <div style="font-size:0.8rem; color:#666;">${deck.cards.length} æš (é”æˆ: ${percent}%)</div>
                        <div class="progress-bar-container"><div style="background:#10b981; height:100%; width:${percent}%"></div></div>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn" style="background:#667eea; color:white; padding:8px 15px;" onclick="openDeck('${id}')">å­¦ç¿’</button>
                        <button class="btn" style="background:white; border:1px solid #ccc; padding:8px 10px;" onclick="exportToExcel('${id}')">ğŸ“¥</button>
                        <button class="btn" style="background:white; border:1px solid #ff4444; color:#ff4444; padding:8px 10px;" onclick="deleteDeck('${id}')">ğŸ—‘ï¸</button>
                    </div>`;
                container.appendChild(item);
            });
        }

        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(sheet, {header: 1});
                const cards = json.slice(1).filter(r => r[0] && r[1]).map(r => ({question: String(r[0]), answer: String(r[1]), mastered: false}));
                const name = file.name.replace(/\.[^/.]+$/, '');
                let id = Object.keys(decks).find(k => decks[k].name === name) || 'deck_' + Date.now();
                decks[id] = { name, cards };
                saveDecks(); renderDecks(); showToast(`"${name}" èª­è¾¼å®Œäº†`);
            };
            reader.readAsArrayBuffer(file);
        });

        function openDeck(id) {
            currentDeckId = id; currentCardIndex = 0; isShuffleOn = false;
            displayOrder = decks[id].cards.map((_, i) => i);
            document.getElementById('flashcardModal').style.display = 'flex';
            updateShuffleUI(); updateCard();
        }

        function updateCard() {
            const deck = decks[currentDeckId];
            const card = deck.cards[displayOrder[currentCardIndex]];
            document.getElementById('flashcardFront').textContent = card.question;
            document.getElementById('flashcardBack').textContent = card.answer;
            document.getElementById('flashcardProgress').textContent = `${currentCardIndex + 1} / ${deck.cards.length}`;
            const mBtn = document.getElementById('masteredBtn');
            if(card.mastered) { 
                mBtn.style.background = '#10b981'; mBtn.style.color = 'white'; mBtn.textContent = 'âœ… è¦šãˆãŸï¼';
            } else { 
                mBtn.style.background = 'white'; mBtn.style.color = '#667eea'; mBtn.textContent = 'â¬œ ã¾ã ';
            }
            document.getElementById('flashcardInner').style.transform = 'rotateY(0deg)';
        }

        function toggleMastered() {
            const card = decks[currentDeckId].cards[displayOrder[currentCardIndex]];
            card.mastered = !card.mastered;
            saveDecks(); updateCard(); renderDecks();
        }

        function flipCard() {
            const inner = document.getElementById('flashcardInner');
            inner.style.transform = inner.style.transform === 'rotateY(180deg)' ? 'rotateY(0deg)' : 'rotateY(180deg)';
        }

        function nextCard() { if (currentCardIndex < displayOrder.length - 1) { currentCardIndex++; updateCard(); } }
        function prevCard() { if (currentCardIndex > 0) { currentCardIndex--; updateCard(); } }

        function toggleShuffle() {
            isShuffleOn = !isShuffleOn;
            if (isShuffleOn) {
                for (let i = displayOrder.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [displayOrder[i], displayOrder[j]] = [displayOrder[j], displayOrder[i]];
                }
                showToast("ã‚·ãƒ£ãƒƒãƒ•ãƒ«ON");
            } else { 
                displayOrder = decks[currentDeckId].cards.map((_, i) => i);
                showToast("ã‚·ãƒ£ãƒƒãƒ•ãƒ«OFF");
            }
            currentCardIndex = 0; updateShuffleUI(); updateCard();
        }

        function updateShuffleUI() {
            const btn = document.getElementById('shuffleBtn');
            btn.style.background = isShuffleOn ? '#f59e0b' : '#e5e7eb';
            btn.style.color = isShuffleOn ? 'white' : '#333';
        }

        function addCard() {
            const q = document.getElementById('newQ').value.trim();
            const a = document.getElementById('newA').value.trim();
            if (!q || !a) return;
            decks[currentDeckId].cards.push({question: q, answer: a, mastered: false});
            displayOrder.push(decks[currentDeckId].cards.length - 1);
            saveDecks(); updateCard(); renderDecks();
            document.getElementById('newQ').value = ''; document.getElementById('newA').value = '';
            showToast("è¿½åŠ ã—ã¾ã—ãŸ");
        }

        function exportToExcel(id) {
            const deck = decks[id];
            const data = [['å•é¡Œ', 'å›ç­”', 'è¦šãˆãŸãƒ•ãƒ©ã‚°']];
            deck.cards.forEach(c => data.push([c.question, c.answer, c.mastered]));
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Cards");
            XLSX.writeFile(wb, `${deck.name}_backup.xlsx`);
        }

        function deleteDeck(id) { if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) { delete decks[id]; saveDecks(); renderDecks(); } }
        function closeFlashcards() { document.getElementById('flashcardModal').style.display = 'none'; }
    </script>
</body>
</html>
